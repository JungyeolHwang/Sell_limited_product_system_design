첫째, 재고 차감은 단일 조건 UPDATE로 처리합니다.
available >= 요청수량 조건을 둬서 한 줄만 성공하도록 보장하면, 수천 명이 동시에 요청해도 초과 판매가 일어나지 않습니다.

둘째, 중복과 동시 요청을 제어하는 보조 장치를 둡니다.
멱등성 테이블은 같은 요청을 여러 번 보내도 한 번만 처리하게 하고,
추가로 user_active_hold는 ‘1인 1건 예약’ 제약을 PK로 강제해 동시·다중 시도를 차단합니다.
MySQL이 조건부 유니크를 지원하지 않기 때문에, 이 보조 테이블이 꼭 필요합니다.

셋째, 상태 전이와 원장 기록으로 정합성을 유지합니다.
만료된 예약을 단순 삭제하지 않고 EXPIRED로 남기기 때문에,
재고 복원 과정이 추적 가능하고 결제와 만료 충돌 시에도 안전하게 처리할 수 있습니다.