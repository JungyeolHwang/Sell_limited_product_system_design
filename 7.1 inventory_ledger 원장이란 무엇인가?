제가 inventory_ledger(감사 원장) 개념을 마트 영수증 비유로 쉽게 풀어드릴게요.

쉽게 말하면

inventory_counter = 현재 남은 재고 수량만 보여주는 전광판

inventory_ledger = 재고가 언제, 왜, 몇 개 변했는지 다 적힌 영수증 모음함

마트 비유

마트에서 사과가 100개 남았어요.
전광판에는 사과 재고: 100개라고 적혀있죠.
근데 손님이 3개를 사가면:

전광판(inventory_counter) 숫자가 100 → 97로 바뀜

동시에, **영수증(inventory_ledger)**에 이렇게 기록:

날짜: 2025-08-15 15:12
품목: 사과
변화량: -3
이유: 예약(결제 대기)
예약번호: 12345

왜 이렇게 하냐?

전광판만 보면 “지금 남은 재고”는 알 수 있지만, 왜 줄었는지는 알 수 없어요.

영수증 모음을 보면 “누가, 언제, 왜, 몇 개를” 가져갔는지 다 알 수 있어요.

나중에 재고 수량이 이상하면, 영수증을 모두 합산해서 진짜 맞는 수량을 다시 계산할 수 있어요.

트랜잭션 T1에서 하는 일

재고 줄임 → 전광판 숫자 변경

예약 생성 → 주문 대기 상태 저장

영수증 기록 → 누가 왜 몇 개를 줄였는지 영수증에 한 줄 추가

즉, inventory_ledger에 INSERT 한 번 하는 거예요.

진짜 중요한 한 줄

inventory_ledger는 재고 변화를 기록하는 영수증 테이블이에요.
재고를 줄이거나 늘릴 때마다 이유·수량·시간을 INSERT로 남겨서,
나중에 복구나 감사가 가능하게 하는 거예요.



inventory_counter(전광판) + inventory_ledger(영수증함) 동작을 그림처럼 보여드릴게요.

📦 재고 시스템 비유
[ 전광판: inventory_counter ]
┌───────────────────┐
│ 사과 재고: 100개  │
└───────────────────┘
    ↑
    │ 숫자만 보임
    │

[ 영수증함: inventory_ledger ]
┌─────────────────────────────────────────────┐
│ 날짜       품목   변화량   이유      예약번호 │
│─────────────────────────────────────────────│
│ 08/15 10:00 사과   -5    예약       H1234   │
│ 08/15 10:05 사과   +2    결제취소   H1209   │
│ 08/15 10:15 사과   -3    예약       H1235   │
│ ...                                         │
└─────────────────────────────────────────────┘
    ↑
    │ 언제, 왜, 얼마나 바뀌었는지
    │ 모든 기록이 다 있음

💡 흐름 예시
1) 재고 차감 (예약)

전광판: 100 → 97 (inventory_counter 업데이트)

영수증함에 기록: -3, 이유=예약, 예약번호=H1235 (inventory_ledger INSERT)

2) 결제 취소

전광판: 97 → 99 (재고 복원)

영수증함에 기록: +2, 이유=결제취소, 예약번호=H1209

🎯 왜 둘 다 필요하나?

전광판만 있으면 지금 남은 수량은 알 수 있지만, “왜 이렇게 됐는지”는 몰라요.

영수증만 있으면 누적해서 계산해야 현재 수량을 알 수 있어요 → 실시간 불편.

그래서 전광판(inventory_counter) + 영수증함(inventory_ledger)을 같이 운용:

전광판 = 빠른 조회용 (현재 재고)

영수증함 = 히스토리 & 감사 & 복구용

📌 트랜잭션 T1에서의 위치

멱등성 체크

1인 중복 주문 방지

전광판 숫자 줄임 (inventory_counter)

예약 생성

영수증에 기록 남김 (inventory_ledger) ← 여기!

이제 이 그림처럼 기억하시면 돼요:

재고 변경 시 → 전광판 숫자 바꾸고 → 영수증 한 장 발급해서 보관